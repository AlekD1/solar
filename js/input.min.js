var datGUI;
var pauseButton;
var followDropDown;
var followedObjectName = "Солнце";
var followableNames = [];
var showAsteroids = true;
var showSkybox = true;
var now = new Date();
var dataString = now.getDate() + "." + ("0" + (now.getMonth() + 1)).slice(-2) + "." + now.getFullYear();
createFollowablePlanetsArray();
function loadGUI() {
    datGUI = new dat.GUI({
        autoplace: false
    });
    var container = document.getElementById("guiContainer");
    container.appendChild(datGUI.domElement);
    datGUI.add(this, 'showHelp').name("Справка");
    datGUI.add(this, 'centuriesPerSecond', -0.1, +0.1).name("Скорость").step(0.00001).listen();
    pauseButton = datGUI.add(this, 'tooglePause').name("Пауза").listen();
    datGUI.add(this, 'showAsteroids').name("Астероиды").onChange(toogleAsteroidBelts);
    datGUI.add(this, 'showSkybox').name("Млечный Путь").onChange(toogleSkybox);
    followDropDown = datGUI.add(this, 'followedObjectName', followableNames).name("Слежение").onChange(followListener).listen();
    datGUI.add(this, 'dataString').name("Начальная дата").onChange(timeChange).listen();
    datGUI.add(this, 'screenshot').name("Скриншот");
}
function timeChange() {
    epoch = unixToEpoch(Date.parse(dataString.trim().split('.').reverse().join('-')) / 1000.0);
}
function toogleAsteroidBelts() {
    if (showAsteroids) {
        enableAsteroidBelts();
    } else {
        disableAsteroidBelts();
    }
}
function showHelp() {
    var aboutDiv = document.getElementById('about');
    var bellowDiv = document.getElementById('bellowAbout');
    aboutDiv.classList.add('showAbout');
    doNotUpdate = true;
}
function closeHelp() {
    var aboutDiv = document.getElementById('about');
    var bellowDiv = document.getElementById('');
    aboutDiv.classList.remove('showAbout');
    doNotUpdate = false;
}
function toogleSkybox() {
    if (showSkybox) {
        scene.add(skyboxMesh);
    } else {
        scene.remove(scene.getObjectById(skyboxMesh.id));
    }
}
function enableAsteroidBelts() {
    for (sprite of celestialBodySprites) {
        if (sprite.flag == ASTEROID_BELT_FLAG) {
            sprite.addTo(scene);
            sprite.shouldDisplay = true;
        }
    }
}
function disableAsteroidBelts() {
    for (sprite of celestialBodySprites) {
        if (sprite.flag == ASTEROID_BELT_FLAG) {
            sprite.removeFrom(scene);
            sprite.shouldDisplay = false;
        }
    }
}
function tooglePause() {
    if (centuriesPerSecond != 0) {
        pauseButton.name("Старт");
        centuriesPerSecond = 0;
    } else {
        pauseButton.name("Пауза");
        centuriesPerSecond = 0.0002;
    }
}
function createFollowablePlanetsArray() {
    followableNames = ["Солнце"];
    for (body of followablePlanets) {
        followableNames.push(body.name);
    }
}
function followListener() {
    if (followedObjectName == "Солнце") {
        followedObjectId = -1;
    } else {
        for (var i = 0; i < celestialBodySprites.length; i++) {
            if (celestialBodySprites[i].planet.name == followedObjectName) {
                followedObjectId = i;
                console.log(i);
                break;
            }
        }
    }
}
function screenshot() {
    var dataURL = renderer.domElement.toDataURL();
    var newWindow = window.open();
    var img = newWindow.document.createElement("img");
    img.src = dataURL;
    newWindow.document.body.appendChild(img);
}
window.onkeydown = function (e) {
    var code = e.keyCode ? e.keyCode : e.which;
    if (code === 32) {
        tooglePause();
    } else if (code === 39) {
        centuriesPerSecond *= 1.1;
    } else if (code === 37) {
        centuriesPerSecond /= 1.1;
    } else if (code === 27) {
        closeHelp();
    }
};
